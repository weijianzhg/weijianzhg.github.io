<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta name="google-site-verification" content="UIZ66Z3Vv0JzUZR1B68ZBjVz3aXIplcxvvduu_p6l80"> <meta http-equiv="Permissions-Policy" content="interest-cohort=()"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Building Custom Machine Learning Models | Weijian Zhang </title> <meta name="author" content="Weijian Zhang"> <meta name="description" content="Building a custom machine learning model with Scikit-learn base classes and use it within the scikit-learning ecosystem."> <meta name="keywords" content="weijian zhang, blog, AI, machine learning, finance"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/favicon.ico?6bff22418c3b7edcf22f386906ecfee3"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://weijianzhg.com/blog/2021/custom-machine-learning-model/"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?0afe9f0ae161375728f7bcc5eb5b4ab4"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Weijian</span> Zhang </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Building Custom Machine Learning Models</h1> <p class="post-meta"> December 06, 2021 </p> <p class="post-tags"> <a href="/blog/2021"> <i class="fa-solid fa-calendar fa-sm"></i> 2021 </a>   ·   <a href="/blog/tag/machine-learning"> <i class="fa-solid fa-hashtag fa-sm"></i> machine-learning,</a>   <a href="/blog/tag/custom-model"> <i class="fa-solid fa-hashtag fa-sm"></i> custom-model,</a>   <a href="/blog/tag/scikit-learn"> <i class="fa-solid fa-hashtag fa-sm"></i> scikit-learn</a>     ·   <a href="/blog/category/machine-learning-engineering"> <i class="fa-solid fa-tag fa-sm"></i> machine-learning-engineering</a>   </p> </header> <article class="post-content"> <div id="table-of-contents"> <ul id="toc" class="section-nav"> <li class="toc-entry toc-h2"><a href="#basic-components-of-a-machine-learning-model">Basic Components of a Machine Learning Model</a></li> <li class="toc-entry toc-h2"><a href="#a-simple-custom-machine-learning-model-for-classifying-iris-species">A Simple Custom Machine Learning Model For Classifying Iris Species</a></li> <li class="toc-entry toc-h2"><a href="#using-custom-machine-learning-models-within-the-scikit-learn-ecosystem">Using Custom Machine Learning Models within the Scikit-learn Ecosystem</a></li> </ul> </div> <hr> <div id="markdown-content"> <p>Sometimes, in order to meet a specific business need it is best to create a custom machine learning model. In this article we discuss how to create such models. We show how use the custom machine learning models within the scikit-learn ecosystem. For example, we can apply scikit-learn’s <code class="language-plaintext highlighter-rouge">GridSearchCV</code> on our custom machine learning models to find the best hyperparameters.</p> <h2 id="basic-components-of-a-machine-learning-model">Basic Components of a Machine Learning Model</h2> <p>A (supervised) machine learning model has two main components: <code class="language-plaintext highlighter-rouge">fit</code> and <code class="language-plaintext highlighter-rouge">predict</code>. We use the <code class="language-plaintext highlighter-rouge">fit</code> method to learn from data and use <code class="language-plaintext highlighter-rouge">predict</code> to make predictions on new data.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">MLModel</span><span class="p">():</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="sh">"</span><span class="s">train the model on a dataset</span><span class="sh">"</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="sh">"</span><span class="s">predict y on unseen dataset</span><span class="sh">"</span>
</code></pre></div></div> <h2 id="a-simple-custom-machine-learning-model-for-classifying-iris-species">A Simple Custom Machine Learning Model For Classifying Iris Species</h2> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/iris-480.webp 480w,/assets/img/iris-800.webp 800w,/assets/img/iris-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/iris.jpeg" class="rounded z-depth-1" width="120px" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <p>Let’s consider the classic <a href="https://archive.ics.uci.edu/ml/datasets/iris" rel="external nofollow noopener" target="_blank">Iris dataset</a>. The dataset consists of samples from three Iris species (Iris setosa, Iris virginica, Iris versicolor) with four features (sepal length, sepal width, petal length, petal width). We can load it from <code class="language-plaintext highlighter-rouge">sklearn.datasets</code>.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">sklearn.datasets</span> <span class="kn">import</span> <span class="n">load_iris</span>

<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nf">load_iris</span><span class="p">(</span><span class="n">return_X_y</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">as_frame</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">X</span>
</code></pre></div></div> <div> <style scoped="">.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</style> <table border="1" class="dataframe"> <thead> <tr style="text-align: right;"> <th></th> <th>sepal length (cm)</th> <th>sepal width (cm)</th> <th>petal length (cm)</th> <th>petal width (cm)</th> </tr> </thead> <tbody> <tr> <th>0</th> <td>5.1</td> <td>3.5</td> <td>1.4</td> <td>0.2</td> </tr> <tr> <th>1</th> <td>4.9</td> <td>3.0</td> <td>1.4</td> <td>0.2</td> </tr> <tr> <th>2</th> <td>4.7</td> <td>3.2</td> <td>1.3</td> <td>0.2</td> </tr> <tr> <th>3</th> <td>4.6</td> <td>3.1</td> <td>1.5</td> <td>0.2</td> </tr> <tr> <th>4</th> <td>5.0</td> <td>3.6</td> <td>1.4</td> <td>0.2</td> </tr> <tr> <th>...</th> <td>...</td> <td>...</td> <td>...</td> <td>...</td> </tr> <tr> <th>145</th> <td>6.7</td> <td>3.0</td> <td>5.2</td> <td>2.3</td> </tr> <tr> <th>146</th> <td>6.3</td> <td>2.5</td> <td>5.0</td> <td>1.9</td> </tr> <tr> <th>147</th> <td>6.5</td> <td>3.0</td> <td>5.2</td> <td>2.0</td> </tr> <tr> <th>148</th> <td>6.2</td> <td>3.4</td> <td>5.4</td> <td>2.3</td> </tr> <tr> <th>149</th> <td>5.9</td> <td>3.0</td> <td>5.1</td> <td>1.8</td> </tr> </tbody> </table> <p>150 rows × 4 columns</p> </div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">X</span><span class="p">.</span><span class="nf">describe</span><span class="p">()</span>
</code></pre></div></div> <div> <style scoped="">.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</style> <table border="1" class="dataframe"> <thead> <tr style="text-align: right;"> <th></th> <th>sepal length (cm)</th> <th>sepal width (cm)</th> <th>petal length (cm)</th> <th>petal width (cm)</th> </tr> </thead> <tbody> <tr> <th>count</th> <td>150.000000</td> <td>150.000000</td> <td>150.000000</td> <td>150.000000</td> </tr> <tr> <th>mean</th> <td>5.843333</td> <td>3.057333</td> <td>3.758000</td> <td>1.199333</td> </tr> <tr> <th>std</th> <td>0.828066</td> <td>0.435866</td> <td>1.765298</td> <td>0.762238</td> </tr> <tr> <th>min</th> <td>4.300000</td> <td>2.000000</td> <td>1.000000</td> <td>0.100000</td> </tr> <tr> <th>25%</th> <td>5.100000</td> <td>2.800000</td> <td>1.600000</td> <td>0.300000</td> </tr> <tr> <th>50%</th> <td>5.800000</td> <td>3.000000</td> <td>4.350000</td> <td>1.300000</td> </tr> <tr> <th>75%</th> <td>6.400000</td> <td>3.300000</td> <td>5.100000</td> <td>1.800000</td> </tr> <tr> <th>max</th> <td>7.900000</td> <td>4.400000</td> <td>6.900000</td> <td>2.500000</td> </tr> </tbody> </table> </div> <p>It’s clear that sepal length, sepal width, petal length, and petal width should be positive numbers.</p> <p>Let’s create a simple custom machine learning model: train the model using Support Vector Classification (SVC) but only make predictions if all the features are positive, return <code class="language-plaintext highlighter-rouge">unknown</code> otherwise.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">from</span> <span class="n">sklearn</span> <span class="kn">import</span> <span class="n">svm</span>


<span class="k">class</span> <span class="nc">MLModel</span><span class="p">():</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">kernel</span><span class="o">=</span><span class="sh">'</span><span class="s">linear</span><span class="sh">'</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">kernel</span><span class="o">=</span><span class="n">kernel</span>
        <span class="n">self</span><span class="p">.</span><span class="n">C</span> <span class="o">=</span> <span class="n">C</span>
        <span class="n">self</span><span class="p">.</span><span class="n">clf</span> <span class="o">=</span> <span class="n">svm</span><span class="p">.</span><span class="nc">SVC</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">C</span><span class="p">,</span> <span class="n">kernel</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">kernel</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="sh">"</span><span class="s">train the model on a dataset</span><span class="sh">"</span>
        <span class="n">self</span><span class="p">.</span><span class="n">clf</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="sh">"</span><span class="s">predict y on unseen dataset</span><span class="sh">"</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">X</span><span class="p">.</span><span class="nf">iterrows</span><span class="p">():</span>
            <span class="nf">if </span><span class="p">(</span><span class="n">row</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">).</span><span class="nf">all</span><span class="p">():</span>
                <span class="n">prediction</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">clf</span><span class="p">.</span><span class="nf">predict</span><span class="p">(</span><span class="n">row</span><span class="p">.</span><span class="nf">to_frame</span><span class="p">().</span><span class="n">T</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">prediction</span> <span class="o">=</span> <span class="sh">'</span><span class="s">unknown</span><span class="sh">'</span>
            <span class="n">predictions</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">prediction</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">predictions</span>

<span class="n">model</span> <span class="o">=</span> <span class="nc">MLModel</span><span class="p">()</span>
</code></pre></div></div> <p>We can now train the model on the Iris dataset.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">model</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</code></pre></div></div> <p>To try our trained model we create three test samples. Note that the second sample has <code class="language-plaintext highlighter-rouge">0.0</code> sepal length and the third sample has sepal width equal to <code class="language-plaintext highlighter-rouge">-1.0</code>.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">X_new</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">({</span>
    <span class="sh">'</span><span class="s">sepal length (cm)</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="mf">2.3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">6.3</span><span class="p">],</span>
    <span class="sh">'</span><span class="s">sepal width (cm)</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
    <span class="sh">'</span><span class="s">petal length (cm)</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.4</span><span class="p">,</span> <span class="mf">4.2</span><span class="p">,</span> <span class="mf">5.4</span><span class="p">],</span>
    <span class="sh">'</span><span class="s">petal width (cm)</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.3</span><span class="p">,</span> <span class="mf">1.9</span><span class="p">]</span>
<span class="p">})</span>
<span class="n">X_new</span>
</code></pre></div></div> <div> <style scoped="">.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</style> <table border="1" class="dataframe"> <thead> <tr style="text-align: right;"> <th></th> <th>sepal length (cm)</th> <th>sepal width (cm)</th> <th>petal length (cm)</th> <th>petal width (cm)</th> </tr> </thead> <tbody> <tr> <th>0</th> <td>2.3</td> <td>2.5</td> <td>1.4</td> <td>2.0</td> </tr> <tr> <th>1</th> <td>0.0</td> <td>3.0</td> <td>4.2</td> <td>2.3</td> </tr> <tr> <th>2</th> <td>6.3</td> <td>-1.0</td> <td>5.4</td> <td>1.9</td> </tr> </tbody> </table> </div> <p>As expected our model only returns a prediction for first sample and returns <code class="language-plaintext highlighter-rouge">unknown</code> for the second and the third samples.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">model</span><span class="p">.</span><span class="nf">predict</span><span class="p">(</span><span class="n">X_new</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[0, 'unknown', 'unknown']
</code></pre></div></div> <h2 id="using-custom-machine-learning-models-within-the-scikit-learn-ecosystem">Using Custom Machine Learning Models within the Scikit-learn Ecosystem</h2> <p>In order to use our custom machine learning model within the scikit-learn ecosystem, we need to provide a few other methods:</p> <ul> <li> <code class="language-plaintext highlighter-rouge">get_params</code>: returns a dict of parameters of the machine learning model.</li> <li> <code class="language-plaintext highlighter-rouge">set_params</code>: takes a dictionary of parameters as input and sets the parameter of the machine learning model.</li> <li> <code class="language-plaintext highlighter-rouge">score</code>: provides a default evaluation criterion for the problem they are designed to solve.</li> </ul> <p>We can either implement these methods ourselves or just inherit these methods from <code class="language-plaintext highlighter-rouge">sklearn.base.BaseEstimator</code> and <code class="language-plaintext highlighter-rouge">sklearn.base.ClassifierMixin</code>.</p> <p><code class="language-plaintext highlighter-rouge">BaseEstimator</code> provides the implementation of the <code class="language-plaintext highlighter-rouge">get_params</code> and <code class="language-plaintext highlighter-rouge">set_params</code> methods. <code class="language-plaintext highlighter-rouge">ClassifierMixin</code> provides the implementation of the <code class="language-plaintext highlighter-rouge">score</code> method as the mean accuracy.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">sklearn.base</span> <span class="kn">import</span> <span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">ClassifierMixin</span>
<span class="kn">from</span> <span class="n">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>


<span class="k">class</span> <span class="nc">MLModel</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">ClassifierMixin</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">kernel</span><span class="o">=</span><span class="sh">'</span><span class="s">linear</span><span class="sh">'</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">kernel</span><span class="o">=</span><span class="n">kernel</span>
        <span class="n">self</span><span class="p">.</span><span class="n">C</span> <span class="o">=</span> <span class="n">C</span>
        <span class="n">self</span><span class="p">.</span><span class="n">clf</span> <span class="o">=</span> <span class="n">svm</span><span class="p">.</span><span class="nc">SVC</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">C</span><span class="p">,</span> <span class="n">kernel</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">kernel</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="sh">"</span><span class="s">train the model on a dataset</span><span class="sh">"</span>
        <span class="n">self</span><span class="p">.</span><span class="n">clf</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="sh">"</span><span class="s">predict y on unseen dataset</span><span class="sh">"</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">X</span><span class="p">.</span><span class="nf">iterrows</span><span class="p">():</span>
            <span class="nf">if </span><span class="p">(</span><span class="n">row</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">).</span><span class="nf">all</span><span class="p">():</span>
                <span class="n">prediction</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">clf</span><span class="p">.</span><span class="nf">predict</span><span class="p">(</span><span class="n">row</span><span class="p">.</span><span class="nf">to_frame</span><span class="p">().</span><span class="n">T</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">prediction</span> <span class="o">=</span> <span class="sh">'</span><span class="s">unknown</span><span class="sh">'</span>
            <span class="n">predictions</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">prediction</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">predictions</span>


<span class="n">model</span> <span class="o">=</span> <span class="nc">MLModel</span><span class="p">()</span>
</code></pre></div></div> <p>Since we’ve defined <code class="language-plaintext highlighter-rouge">MLModel</code> as a subclass of <code class="language-plaintext highlighter-rouge">BaseEstimator</code> and <code class="language-plaintext highlighter-rouge">ClassifierMixin</code>, we can use <code class="language-plaintext highlighter-rouge">get_params</code> to retrieve all the parameters and use <code class="language-plaintext highlighter-rouge">score</code> to compute the mean accuracy on the test dataset.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">model</span><span class="p">.</span><span class="nf">get_params</span><span class="p">()</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{'C': 1.0, 'kernel': 'linear'}
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="nf">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="n">model</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">model</span><span class="p">.</span><span class="nf">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1.0
</code></pre></div></div> <p>Our custom machine learning model also works fine with scikit-learn’s <code class="language-plaintext highlighter-rouge">GridSearchCV</code>.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>

<span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="sh">'</span><span class="s">kernel</span><span class="sh">'</span><span class="p">:(</span><span class="sh">'</span><span class="s">linear</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">rbf</span><span class="sh">'</span><span class="p">),</span> <span class="sh">'</span><span class="s">C</span><span class="sh">'</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">]}</span>


<span class="n">clf</span> <span class="o">=</span> <span class="nc">GridSearchCV</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">parameters</span><span class="p">)</span>
<span class="n">clf</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GridSearchCV(estimator=MLModel(),
             param_grid={'C': [1, 10], 'kernel': ('linear', 'rbf')})
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">clf</span><span class="p">.</span><span class="n">best_params_</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{'C': 1, 'kernel': 'linear'}
</code></pre></div></div> <p>Note that for regression problems we need to use <code class="language-plaintext highlighter-rouge">RegressorMixin</code> instead of <code class="language-plaintext highlighter-rouge">ClassifierMixin</code>, which implements the coefficient of determination of the prediction as the <code class="language-plaintext highlighter-rouge">score</code> method. See <a href="https://scikit-learn.org/stable/modules/generated/sklearn.base.RegressorMixin.html" rel="external nofollow noopener" target="_blank">here</a> for more details.</p> </div> </article> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2024 Weijian Zhang. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2930004b8d7fcd0a8e00fdcfc8fc9f24"></script> <script defer src="/assets/js/common.js?da39b660470d1ba6e6b8bf5f37070b6e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-B53R73TEBD"></script> <script>function gtag(){window.dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-B53R73TEBD");</script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>