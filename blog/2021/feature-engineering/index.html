<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta name="google-site-verification" content="UIZ66Z3Vv0JzUZR1B68ZBjVz3aXIplcxvvduu_p6l80"> <meta http-equiv="Permissions-Policy" content="interest-cohort=()"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Feature Engineering in a Pipeline | Weijian Zhang </title> <meta name="author" content="Weijian Zhang"> <meta name="description" content="Build a pipeline to do feature engineering with Scikit-learn."> <meta name="keywords" content="weijian zhang, blog, AI, machine learning, finance"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/favicon.ico?0bed664cab9eebced3bd4b525b99339f"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://weijianzhg.github.io/blog/2021/feature-engineering/"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?0afe9f0ae161375728f7bcc5eb5b4ab4"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Weijian</span> Zhang </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Feature Engineering in a Pipeline</h1> <p class="post-meta"> November 03, 2021 </p> <p class="post-tags"> <a href="/blog/2021"> <i class="fa-solid fa-calendar fa-sm"></i> 2021 </a>   ·   <a href="/blog/tag/feature-engineering"> <i class="fa-solid fa-hashtag fa-sm"></i> feature-engineering,</a>   <a href="/blog/tag/pipeline"> <i class="fa-solid fa-hashtag fa-sm"></i> pipeline,</a>   <a href="/blog/tag/scikit-learn"> <i class="fa-solid fa-hashtag fa-sm"></i> scikit-learn</a>     ·   <a href="/blog/category/machine-learning-engineering"> <i class="fa-solid fa-tag fa-sm"></i> machine-learning-engineering</a>   </p> </header> <article class="post-content"> <div id="table-of-contents"> <ul id="toc" class="section-nav"> <li class="toc-entry toc-h2"><a href="#introduction">Introduction</a></li> <li class="toc-entry toc-h2"><a href="#transforming-numerical-features">Transforming Numerical Features</a></li> <li class="toc-entry toc-h2"><a href="#transforming-categorical-features">Transforming Categorical Features</a></li> <li class="toc-entry toc-h2"> <a href="#building-a-feature-engineering-pipeline">Building a Feature Engineering Pipeline</a> <ul> <li class="toc-entry toc-h3"><a href="#make-a-pipeline">Make a Pipeline</a></li> <li class="toc-entry toc-h3"><a href="#compose-a-column-transformer">Compose a Column Transformer</a></li> </ul> </li> <li class="toc-entry toc-h2"><a href="#design-your-own-transformers">Design Your Own Transformers</a></li> <li class="toc-entry toc-h2"><a href="#conclusion">Conclusion</a></li> </ul> </div> <hr> <div id="markdown-content"> <h2 id="introduction">Introduction</h2> <p>Feature engineering is a process of transforming the given dataset into a form which is easy for the machine learning model to interpret. If we have different transformation functions for training and prediction we may duplicate the same work and it’s harder to maintain (make some changes in one pipeline means we have to update the other pipeline as well).</p> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/feature-engineering-separate-480.webp 480w,/assets/img/feature-engineering-separate-800.webp 800w,/assets/img/feature-engineering-separate-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/feature-engineering-separate.png" class="img-fluid rounded z-depth-1" width="360px" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <p>One common practice in producitionzing machine learning models is to write a transformation <em>pipeline</em> so that we can use the same data transformation code for both training and prediction.</p> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/feature-engineering-one-480.webp 480w,/assets/img/feature-engineering-one-800.webp 800w,/assets/img/feature-engineering-one-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/feature-engineering-one.png" class="img-fluid rounded z-depth-1" width="360px" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <p>In this article, we discuss how we can use <a href="https://scikit-learn.org/stable/" rel="external nofollow noopener" target="_blank">scikit-learn</a> to build a feature engineering pipeline. Let’s first have a look at a few common transformations for numeric features and categorical features.</p> <h2 id="transforming-numerical-features">Transforming Numerical Features</h2> <p>One thing I really like about scikit-learn is that I can use the same ‘‘fit’’ and ‘‘predict’’ pattern for data preprocessing. For a preprocessor, the two methods are called <code class="language-plaintext highlighter-rouge">fit</code> and <code class="language-plaintext highlighter-rouge">transform</code>.</p> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/feature-engineering-preprocessor-480.webp 480w,/assets/img/feature-engineering-preprocessor-800.webp 800w,/assets/img/feature-engineering-preprocessor-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/feature-engineering-preprocessor.png" class="img-fluid rounded z-depth-1" width="360px" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <p>We can use <code class="language-plaintext highlighter-rouge">SimpleImputer</code> to complete missing values and <code class="language-plaintext highlighter-rouge">StandardScaler</code> to standardize values by removing the mean and scaling to unit variance.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">from</span> <span class="n">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>
<span class="kn">from</span> <span class="n">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
</code></pre></div></div> <p>Let’s create a simple example.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="sh">'</span><span class="s">n1</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
      <span class="sh">'</span><span class="s">n2</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="bp">None</span><span class="p">],</span>
      <span class="sh">'</span><span class="s">n3</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="bp">None</span><span class="p">],</span>
    <span class="p">}</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span>
</code></pre></div></div> <div> <style scoped="">.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</style> <table border="1" class="dataframe"> <thead> <tr style="text-align: right;"> <th></th> <th>n1</th> <th>n2</th> <th>n3</th> </tr> </thead> <tbody> <tr> <th>0</th> <td>20.0</td> <td>0.1</td> <td>-20.0</td> </tr> <tr> <th>1</th> <td>300.0</td> <td>NaN</td> <td>-10.0</td> </tr> <tr> <th>2</th> <td>400.0</td> <td>0.5</td> <td>0.0</td> </tr> <tr> <th>3</th> <td>NaN</td> <td>0.6</td> <td>-30.0</td> </tr> <tr> <th>4</th> <td>100.0</td> <td>NaN</td> <td>NaN</td> </tr> </tbody> </table> </div> <p>We can have a look the mean of each column using the <code class="language-plaintext highlighter-rouge">.mean()</code> method.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">.</span><span class="nf">mean</span><span class="p">()</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>n1    205.0
n2      0.4
n3    -15.0
dtype: float64
</code></pre></div></div> <p>Here we create a <code class="language-plaintext highlighter-rouge">SimpleImputer</code> object with <code class="language-plaintext highlighter-rouge">strategy="mean"</code>. This means we fill the missing value using the mean along each column.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">num_imputer</span> <span class="o">=</span> <span class="nc">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="sh">"</span><span class="s">mean</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div> <p>We first fit our imputer <code class="language-plaintext highlighter-rouge">num_imputer</code> on our simple dataset.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">num_imputer</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SimpleImputer()
</code></pre></div></div> <p>After fitting the model, the statistic, i.e., the fill value for each column, is <em>stored</em> within the imputer <code class="language-plaintext highlighter-rouge">num_imputer</code>.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">num_imputer</span><span class="p">.</span><span class="n">statistics_</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>array([205. ,   0.4, -15. ])
</code></pre></div></div> <p>Now we can fill the missing values in our original dataset with the <code class="language-plaintext highlighter-rouge">transform</code> method. By the way, we can also apply fit and transform in one go with the <code class="language-plaintext highlighter-rouge">fit_transform</code> method.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">imputed_features</span> <span class="o">=</span> <span class="n">num_imputer</span><span class="p">.</span><span class="nf">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">imputed_features</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>array([[ 2.00e+01,  1.00e-01, -2.00e+01],
       [ 3.00e+02,  4.00e-01, -1.00e+01],
       [ 4.00e+02,  5.00e-01,  0.00e+00],
       [ 2.05e+02,  6.00e-01, -3.00e+01],
       [ 1.00e+02,  4.00e-01, -1.50e+01]])
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">type</span><span class="p">(</span><span class="n">imputed_features</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>numpy.ndarray
</code></pre></div></div> <p>The transformed features are stored as <code class="language-plaintext highlighter-rouge">numpy.ndarray</code>. We can convert it back to <code class="language-plaintext highlighter-rouge">pandas.DataFrame</code> with</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">imputed_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">imputed_features</span><span class="p">,</span>
    <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="p">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">df</span><span class="p">.</span><span class="n">columns</span><span class="p">)</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">imputed_df</span>
</code></pre></div></div> <div> <style scoped="">.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</style> <table border="1" class="dataframe"> <thead> <tr style="text-align: right;"> <th></th> <th>n1</th> <th>n2</th> <th>n3</th> </tr> </thead> <tbody> <tr> <th>0</th> <td>20.0</td> <td>0.1</td> <td>-20.0</td> </tr> <tr> <th>1</th> <td>300.0</td> <td>0.4</td> <td>-10.0</td> </tr> <tr> <th>2</th> <td>400.0</td> <td>0.5</td> <td>0.0</td> </tr> <tr> <th>3</th> <td>205.0</td> <td>0.6</td> <td>-30.0</td> </tr> <tr> <th>4</th> <td>100.0</td> <td>0.4</td> <td>-15.0</td> </tr> </tbody> </table> </div> <p>The cool thing is that now we can use the same statistic saved in <code class="language-plaintext highlighter-rouge">num_imputer</code> to transform other datasets. For example here we create a new dataset with only one row.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># New data
</span>
<span class="n">data_new</span> <span class="o">=</span> <span class="p">{</span><span class="sh">'</span><span class="s">n1</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="bp">None</span><span class="p">],</span>
      <span class="sh">'</span><span class="s">n2</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">],</span>
      <span class="sh">'</span><span class="s">n3</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="bp">None</span><span class="p">],</span>
    <span class="p">}</span>

<span class="n">df_new</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">data_new</span><span class="p">)</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_new</span>
</code></pre></div></div> <div> <style scoped="">.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</style> <table border="1" class="dataframe"> <thead> <tr style="text-align: right;"> <th></th> <th>n1</th> <th>n2</th> <th>n3</th> </tr> </thead> <tbody> <tr> <th>0</th> <td>None</td> <td>0.1</td> <td>None</td> </tr> </tbody> </table> </div> <p>We can apply <code class="language-plaintext highlighter-rouge">num_imputer.transform</code> on this new dataset to fill the missing values.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">num_imputer</span><span class="p">.</span><span class="nf">transform</span><span class="p">(</span><span class="n">df_new</span><span class="p">),</span>
    <span class="n">index</span><span class="o">=</span><span class="n">df_new</span><span class="p">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">df_new</span><span class="p">.</span><span class="n">columns</span><span class="p">)</span>
</code></pre></div></div> <div> <style scoped="">.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</style> <table border="1" class="dataframe"> <thead> <tr style="text-align: right;"> <th></th> <th>n1</th> <th>n2</th> <th>n3</th> </tr> </thead> <tbody> <tr> <th>0</th> <td>205.0</td> <td>0.1</td> <td>-15.0</td> </tr> </tbody> </table> </div> <p><code class="language-plaintext highlighter-rouge">StandardScaler</code> works in a similar way. Here we scale the dataset after the imputer step.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">num_scaler</span> <span class="o">=</span> <span class="nc">StandardScaler</span><span class="p">()</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">num_scaler</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">imputed_df</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>StandardScaler()
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">num_scaler</span><span class="p">.</span><span class="nf">transform</span><span class="p">(</span><span class="n">imputed_df</span><span class="p">),</span>
    <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="p">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">df</span><span class="p">.</span><span class="n">columns</span><span class="p">)</span>
</code></pre></div></div> <div> <style scoped="">.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</style> <table border="1" class="dataframe"> <thead> <tr style="text-align: right;"> <th></th> <th>n1</th> <th>n2</th> <th>n3</th> </tr> </thead> <tbody> <tr> <th>0</th> <td>-1.361620</td> <td>-1.792843e+00</td> <td>-0.5</td> </tr> <tr> <th>1</th> <td>0.699210</td> <td>-3.317426e-16</td> <td>0.5</td> </tr> <tr> <th>2</th> <td>1.435221</td> <td>5.976143e-01</td> <td>1.5</td> </tr> <tr> <th>3</th> <td>0.000000</td> <td>1.195229e+00</td> <td>-1.5</td> </tr> <tr> <th>4</th> <td>-0.772811</td> <td>-3.317426e-16</td> <td>0.0</td> </tr> </tbody> </table> </div> <h2 id="transforming-categorical-features">Transforming Categorical Features</h2> <p><code class="language-plaintext highlighter-rouge">OneHotEncoder</code> is commonly used to transform categorical features. Essentially, for each unique value in the original categorical column, a new column is created to represent this value. Each column is filled up with zeros (the value exists) and ones (the value doesn’t exist).</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span>


<span class="n">cat_encoder</span> <span class="o">=</span> <span class="nc">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="sh">'</span><span class="s">ignore</span><span class="sh">'</span><span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="sh">'</span><span class="s">c1</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="sh">'</span><span class="s">Male</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Female</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Male</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Female</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Female</span><span class="sh">'</span><span class="p">],</span>
      <span class="sh">'</span><span class="s">c2</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="sh">'</span><span class="s">Apple</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Orange</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Apple</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Banana</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Pear</span><span class="sh">'</span><span class="p">],</span>
    <span class="p">}</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="n">df</span>
</code></pre></div></div> <div> <style scoped="">.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</style> <table border="1" class="dataframe"> <thead> <tr style="text-align: right;"> <th></th> <th>c1</th> <th>c2</th> </tr> </thead> <tbody> <tr> <th>0</th> <td>Male</td> <td>Apple</td> </tr> <tr> <th>1</th> <td>Female</td> <td>Orange</td> </tr> <tr> <th>2</th> <td>Male</td> <td>Apple</td> </tr> <tr> <th>3</th> <td>Female</td> <td>Banana</td> </tr> <tr> <th>4</th> <td>Female</td> <td>Pear</td> </tr> </tbody> </table> </div> <p>Let’s first <code class="language-plaintext highlighter-rouge">fit</code> a one hot encoder to a dataset.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cat_encoder</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>OneHotEncoder(handle_unknown='ignore')
</code></pre></div></div> <p>Note that the categories of each column is stored in attribute <code class="language-plaintext highlighter-rouge">.categories_</code>.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cat_encoder</span><span class="p">.</span><span class="n">categories_</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[array(['Female', 'Male'], dtype=object),
 array(['Apple', 'Banana', 'Orange', 'Pear'], dtype=object)]
</code></pre></div></div> <p>Here is the encoded dataset.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">cat_encoder</span><span class="p">.</span><span class="nf">transform</span><span class="p">(</span><span class="n">df</span><span class="p">).</span><span class="nf">toarray</span><span class="p">(),</span>
    <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="p">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">cat_encoder</span><span class="p">.</span><span class="nf">get_feature_names_out</span><span class="p">())</span>
</code></pre></div></div> <div> <style scoped="">.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</style> <table border="1" class="dataframe"> <thead> <tr style="text-align: right;"> <th></th> <th>c1_Female</th> <th>c1_Male</th> <th>c2_Apple</th> <th>c2_Banana</th> <th>c2_Orange</th> <th>c2_Pear</th> </tr> </thead> <tbody> <tr> <th>0</th> <td>0.0</td> <td>1.0</td> <td>1.0</td> <td>0.0</td> <td>0.0</td> <td>0.0</td> </tr> <tr> <th>1</th> <td>1.0</td> <td>0.0</td> <td>0.0</td> <td>0.0</td> <td>1.0</td> <td>0.0</td> </tr> <tr> <th>2</th> <td>0.0</td> <td>1.0</td> <td>1.0</td> <td>0.0</td> <td>0.0</td> <td>0.0</td> </tr> <tr> <th>3</th> <td>1.0</td> <td>0.0</td> <td>0.0</td> <td>1.0</td> <td>0.0</td> <td>0.0</td> </tr> <tr> <th>4</th> <td>1.0</td> <td>0.0</td> <td>0.0</td> <td>0.0</td> <td>0.0</td> <td>1.0</td> </tr> </tbody> </table> </div> <p>We can now use <code class="language-plaintext highlighter-rouge">cat_encoder</code> to <code class="language-plaintext highlighter-rouge">transform</code> new dataset.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_new</span> <span class="o">=</span> <span class="p">{</span><span class="sh">'</span><span class="s">c1</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="sh">'</span><span class="s">Female</span><span class="sh">'</span><span class="p">],</span> <span class="sh">'</span><span class="s">c2</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="sh">'</span><span class="s">Orange</span><span class="sh">'</span><span class="p">]}</span>

<span class="n">df_new</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">data_new</span><span class="p">)</span>

<span class="n">df_new</span>
</code></pre></div></div> <div> <style scoped="">.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</style> <table border="1" class="dataframe"> <thead> <tr style="text-align: right;"> <th></th> <th>c1</th> <th>c2</th> </tr> </thead> <tbody> <tr> <th>0</th> <td>Female</td> <td>Orange</td> </tr> </tbody> </table> </div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">cat_encoder</span><span class="p">.</span><span class="nf">transform</span><span class="p">(</span><span class="n">df_new</span><span class="p">).</span><span class="nf">toarray</span><span class="p">(),</span>
    <span class="n">index</span><span class="o">=</span><span class="n">df_new</span><span class="p">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">cat_encoder</span><span class="p">.</span><span class="nf">get_feature_names_out</span><span class="p">())</span>
</code></pre></div></div> <div> <style scoped="">.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</style> <table border="1" class="dataframe"> <thead> <tr style="text-align: right;"> <th></th> <th>c1_Female</th> <th>c1_Male</th> <th>c2_Apple</th> <th>c2_Banana</th> <th>c2_Orange</th> <th>c2_Pear</th> </tr> </thead> <tbody> <tr> <th>0</th> <td>1.0</td> <td>0.0</td> <td>0.0</td> <td>0.0</td> <td>1.0</td> <td>0.0</td> </tr> </tbody> </table> </div> <h2 id="building-a-feature-engineering-pipeline">Building a Feature Engineering Pipeline</h2> <h3 id="make-a-pipeline">Make a Pipeline</h3> <p>For numerical features, we can make a <code class="language-plaintext highlighter-rouge">pipeline</code> to first fill the missing values with median and then apply standard scaler; for categorical features, we can make a <code class="language-plaintext highlighter-rouge">pipeline</code> to first fill the missing values with the word “missing” and then apply one hot encoder.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">make_pipeline</span>

<span class="n">numeric_transformer</span> <span class="o">=</span> <span class="nf">make_pipeline</span><span class="p">(</span><span class="nc">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="sh">"</span><span class="s">median</span><span class="sh">"</span><span class="p">),</span>
                                    <span class="nc">StandardScaler</span><span class="p">())</span>

<span class="n">categorical_transformer</span> <span class="o">=</span> <span class="nf">make_pipeline</span><span class="p">(</span>
            <span class="nc">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="sh">"</span><span class="s">constant</span><span class="sh">"</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="sh">"</span><span class="s">missing</span><span class="sh">"</span><span class="p">),</span>
            <span class="nc">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="sh">"</span><span class="s">ignore</span><span class="sh">"</span><span class="p">),)</span>

</code></pre></div></div> <p>The transformer pipelines can be used the same way as the individual transformers, i.e., we can <code class="language-plaintext highlighter-rouge">fit</code> a pipeline with some data and use this pipeline to <code class="language-plaintext highlighter-rouge">transform</code> new data. For example,</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="sh">'</span><span class="s">n1</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
      <span class="sh">'</span><span class="s">n2</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="bp">None</span><span class="p">],</span>
      <span class="sh">'</span><span class="s">n3</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="bp">None</span><span class="p">],</span>
    <span class="p">}</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">df</span>
</code></pre></div></div> <div> <style scoped="">.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</style> <table border="1" class="dataframe"> <thead> <tr style="text-align: right;"> <th></th> <th>n1</th> <th>n2</th> <th>n3</th> </tr> </thead> <tbody> <tr> <th>0</th> <td>20.0</td> <td>0.1</td> <td>-20.0</td> </tr> <tr> <th>1</th> <td>300.0</td> <td>NaN</td> <td>-10.0</td> </tr> <tr> <th>2</th> <td>400.0</td> <td>0.5</td> <td>0.0</td> </tr> <tr> <th>3</th> <td>NaN</td> <td>0.6</td> <td>-30.0</td> </tr> <tr> <th>4</th> <td>100.0</td> <td>NaN</td> <td>NaN</td> </tr> </tbody> </table> </div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">numeric_transformer</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Pipeline(steps=[('simpleimputer', SimpleImputer(strategy='median')),
                ('standardscaler', StandardScaler())])
</code></pre></div></div> <p>Notice that the result is exactly the same as the example we give before (apply imputer and then scaler seperately).</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">numeric_transformer</span><span class="p">.</span><span class="nf">transform</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="p">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">df</span><span class="p">.</span><span class="n">columns</span><span class="p">)</span>
</code></pre></div></div> <div> <style scoped="">.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</style> <table border="1" class="dataframe"> <thead> <tr style="text-align: right;"> <th></th> <th>n1</th> <th>n2</th> <th>n3</th> </tr> </thead> <tbody> <tr> <th>0</th> <td>-1.354113</td> <td>-1.950034</td> <td>-0.5</td> </tr> <tr> <th>1</th> <td>0.706494</td> <td>0.344124</td> <td>0.5</td> </tr> <tr> <th>2</th> <td>1.442425</td> <td>0.344124</td> <td>1.5</td> </tr> <tr> <th>3</th> <td>-0.029437</td> <td>0.917663</td> <td>-1.5</td> </tr> <tr> <th>4</th> <td>-0.765368</td> <td>0.344124</td> <td>0.0</td> </tr> </tbody> </table> </div> <h3 id="compose-a-column-transformer">Compose a Column Transformer</h3> <p>For a real life dataset we may have both numeric features and categorical features. It would be nice to selectively apply numeric transformation on the numeric features and categorical transformation on the categorical features. We can accomplish this goal by composing a <code class="language-plaintext highlighter-rouge">ColumnTransformer</code>.</p> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/feature-engineering-selector-480.webp 480w,/assets/img/feature-engineering-selector-800.webp 800w,/assets/img/feature-engineering-selector-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/feature-engineering-selector.png" class="img-fluid rounded z-depth-1" width="660px" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <p>The example below has columns with numeric values (<code class="language-plaintext highlighter-rouge">'n1'</code>, <code class="language-plaintext highlighter-rouge">'n2'</code>, <code class="language-plaintext highlighter-rouge">'n3'</code>) and categorical values (<code class="language-plaintext highlighter-rouge">'c1'</code>, <code class="language-plaintext highlighter-rouge">'c2'</code>).</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="sh">'</span><span class="s">n1</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
      <span class="sh">'</span><span class="s">n2</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="bp">None</span><span class="p">],</span>
      <span class="sh">'</span><span class="s">n3</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="bp">None</span><span class="p">],</span>
      <span class="sh">'</span><span class="s">c1</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="sh">'</span><span class="s">Male</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Female</span><span class="sh">'</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="sh">'</span><span class="s">Female</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Female</span><span class="sh">'</span><span class="p">],</span>
      <span class="sh">'</span><span class="s">c2</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="sh">'</span><span class="s">Apple</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Orange</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Apple</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Banana</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Pear</span><span class="sh">'</span><span class="p">],</span>
    <span class="p">}</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="n">df</span>
</code></pre></div></div> <div> <style scoped="">.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</style> <table border="1" class="dataframe"> <thead> <tr style="text-align: right;"> <th></th> <th>n1</th> <th>n2</th> <th>n3</th> <th>c1</th> <th>c2</th> </tr> </thead> <tbody> <tr> <th>0</th> <td>20.0</td> <td>0.1</td> <td>-20.0</td> <td>Male</td> <td>Apple</td> </tr> <tr> <th>1</th> <td>300.0</td> <td>NaN</td> <td>-10.0</td> <td>Female</td> <td>Orange</td> </tr> <tr> <th>2</th> <td>400.0</td> <td>0.5</td> <td>0.0</td> <td>None</td> <td>Apple</td> </tr> <tr> <th>3</th> <td>NaN</td> <td>0.6</td> <td>-30.0</td> <td>Female</td> <td>Banana</td> </tr> <tr> <th>4</th> <td>100.0</td> <td>NaN</td> <td>NaN</td> <td>Female</td> <td>Pear</td> </tr> </tbody> </table> </div> <p>A <code class="language-plaintext highlighter-rouge">ColumnTransformer</code> stores a list of (name, transformer, columns) tuples as <code class="language-plaintext highlighter-rouge">transformers</code>, which allows different columns to be transformed separately.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span>

<span class="n">preprocessor</span> <span class="o">=</span> <span class="nc">ColumnTransformer</span><span class="p">(</span>
            <span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
                <span class="p">(</span><span class="sh">"</span><span class="s">num</span><span class="sh">"</span><span class="p">,</span> <span class="n">numeric_transformer</span><span class="p">,</span> <span class="p">[</span><span class="sh">"</span><span class="s">n1</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">n2</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">n3</span><span class="sh">"</span><span class="p">]),</span>
                <span class="p">(</span><span class="sh">"</span><span class="s">cat</span><span class="sh">"</span><span class="p">,</span> <span class="n">categorical_transformer</span><span class="p">,</span> <span class="p">[</span><span class="sh">"</span><span class="s">c1</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">c2</span><span class="sh">"</span><span class="p">]),</span>
            <span class="p">]</span>
        <span class="p">)</span>
</code></pre></div></div> <p>We <code class="language-plaintext highlighter-rouge">fit</code> all transformers on dataset <code class="language-plaintext highlighter-rouge">df</code>, transform dataset <code class="language-plaintext highlighter-rouge">df</code>, and concatenate the results with method <code class="language-plaintext highlighter-rouge">fit_transform</code>.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">preprocessor</span><span class="p">.</span><span class="nf">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>array([[-1.35411306, -1.95003374, -0.5       ,  0.        ,  1.        ,
         0.        ,  1.        ,  0.        ,  0.        ,  0.        ],
       [ 0.70649377,  0.3441236 ,  0.5       ,  1.        ,  0.        ,
         0.        ,  0.        ,  0.        ,  1.        ,  0.        ],
       [ 1.44242478,  0.3441236 ,  1.5       ,  0.        ,  0.        ,
         1.        ,  1.        ,  0.        ,  0.        ,  0.        ],
       [-0.02943724,  0.91766294, -1.5       ,  1.        ,  0.        ,
         0.        ,  0.        ,  1.        ,  0.        ,  0.        ],
       [-0.76536825,  0.3441236 ,  0.        ,  1.        ,  0.        ,
         0.        ,  0.        ,  0.        ,  0.        ,  1.        ]])
</code></pre></div></div> <p>After fitting the transformers, we can use <code class="language-plaintext highlighter-rouge">preprocessor</code> on new dataset.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_new</span> <span class="o">=</span> <span class="p">{</span><span class="sh">'</span><span class="s">n1</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">],</span>
      <span class="sh">'</span><span class="s">n2</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="bp">None</span><span class="p">],</span>
      <span class="sh">'</span><span class="s">n3</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">],</span>
      <span class="sh">'</span><span class="s">c1</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="sh">'</span><span class="s">Male</span><span class="sh">'</span><span class="p">],</span>
      <span class="sh">'</span><span class="s">c2</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="bp">None</span><span class="p">],</span>
    <span class="p">}</span>

<span class="n">df_new</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">data_new</span><span class="p">)</span>
<span class="n">df_new</span>

</code></pre></div></div> <div> <style scoped="">.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</style> <table border="1" class="dataframe"> <thead> <tr style="text-align: right;"> <th></th> <th>n1</th> <th>n2</th> <th>n3</th> <th>c1</th> <th>c2</th> </tr> </thead> <tbody> <tr> <th>0</th> <td>10</td> <td>None</td> <td>-10</td> <td>Male</td> <td>None</td> </tr> </tbody> </table> </div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">preprocessor</span><span class="p">.</span><span class="nf">transform</span><span class="p">(</span><span class="n">df_new</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>array([[-1.42770616,  0.3441236 ,  0.5       ,  0.        ,  1.        ,
         0.        ,  0.        ,  0.        ,  0.        ,  0.        ]])
</code></pre></div></div> <h2 id="design-your-own-transformers">Design Your Own Transformers</h2> <p>We can design custom transformers by defining a subclass of <code class="language-plaintext highlighter-rouge">BaseEstimator</code> and <code class="language-plaintext highlighter-rouge">TransformerMixin</code>. There are three methods we need to implement: <code class="language-plaintext highlighter-rouge">__init__</code> , <code class="language-plaintext highlighter-rouge">fit</code>, and <code class="language-plaintext highlighter-rouge">transform</code>.</p> <p>In the example below, we design a simple transformer to first fill missing values with zeros and divide the values by 10.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">sklearn.base</span> <span class="kn">import</span> <span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span>


<span class="k">class</span> <span class="nc">CustomTransformer</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">self</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="p">.</span><span class="nf">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">X</span><span class="o">/</span><span class="mi">10</span>

</code></pre></div></div> <p>Once the custom transformer is initialized, it can be used the same way as any other transformers we discussed before. Here we use the custom transformer on column <code class="language-plaintext highlighter-rouge">"n3"</code>.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">custom_tansformer</span> <span class="o">=</span> <span class="nc">CustomTransformer</span><span class="p">()</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">preprocessor_custom</span> <span class="o">=</span> <span class="nc">ColumnTransformer</span><span class="p">(</span>
            <span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
                <span class="p">(</span><span class="sh">"</span><span class="s">num</span><span class="sh">"</span><span class="p">,</span> <span class="n">numeric_transformer</span><span class="p">,</span> <span class="p">[</span><span class="sh">"</span><span class="s">n1</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">n2</span><span class="sh">"</span><span class="p">]),</span>
                <span class="p">(</span><span class="sh">"</span><span class="s">custom</span><span class="sh">"</span><span class="p">,</span> <span class="n">custom_tansformer</span><span class="p">,</span> <span class="p">[</span><span class="sh">"</span><span class="s">n3</span><span class="sh">"</span><span class="p">]),</span>
                <span class="p">(</span><span class="sh">"</span><span class="s">cat</span><span class="sh">"</span><span class="p">,</span> <span class="n">categorical_transformer</span><span class="p">,</span> <span class="p">[</span><span class="sh">"</span><span class="s">c1</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">c2</span><span class="sh">"</span><span class="p">]),</span>
            <span class="p">]</span>
        <span class="p">)</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">preprocessor_custom</span><span class="p">.</span><span class="nf">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>array([[-1.35411306, -1.95003374, -2.        ,  0.        ,  1.        ,
         0.        ,  1.        ,  0.        ,  0.        ,  0.        ],
       [ 0.70649377,  0.3441236 , -1.        ,  1.        ,  0.        ,
         0.        ,  0.        ,  0.        ,  1.        ,  0.        ],
       [ 1.44242478,  0.3441236 ,  0.        ,  0.        ,  0.        ,
         1.        ,  1.        ,  0.        ,  0.        ,  0.        ],
       [-0.02943724,  0.91766294, -3.        ,  1.        ,  0.        ,
         0.        ,  0.        ,  1.        ,  0.        ,  0.        ],
       [-0.76536825,  0.3441236 ,  0.        ,  1.        ,  0.        ,
         0.        ,  0.        ,  0.        ,  0.        ,  1.        ]])
</code></pre></div></div> <h2 id="conclusion">Conclusion</h2> <p>In summary, we discussed how data transformation can be constructed as a pipeline. We can fit a data transformation pipeline on our training dataset and use the same pipeline to transform new dataset.</p> </div> </article> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2024 Weijian Zhang. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2930004b8d7fcd0a8e00fdcfc8fc9f24"></script> <script defer src="/assets/js/common.js?da39b660470d1ba6e6b8bf5f37070b6e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-B53R73TEBD"></script> <script>function gtag(){window.dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-B53R73TEBD");</script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>